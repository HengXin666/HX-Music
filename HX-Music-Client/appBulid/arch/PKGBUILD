# Maintainer: Heng_Xin <282000500@qq.com>
pkgname=hx-music-client
pkgver=1.0.0
pkgrel=1
pkgdesc="Linux上支持悬浮Ass歌词的音乐播放器"
arch=('x86_64')
url="https://github.com/HengXin666/HX-Music"
license=('GPL-3.0 license')

depends=(
  'qt6-base'
  'qt6-declarative'
  'qt6-svg'
  'qt6-multimedia'
  'libpulse'
  'mesa'
  'tbb'
  'taglib'
  'curl'
  'freetype2'
  'fontconfig'
  'harfbuzz'
  'fribidi'
)
makedepends=('cmake' 'ninja' 'qt6-tools' 'git')

source=("git+https://github.com/HengXin666/HX-Music")
sha256sums=('SKIP')

prepare() {
  cd "$srcdir/HX-Music"
  git submodule update --init --recursive
}

build() {
  cd "$srcdir/HX-Music"
  cmake -B build -S . \
    -G Ninja \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr
  cmake --build build --target HX-Music-Client
}

# 精确安装 QML 文件的替代方案
package() {
  cd "$srcdir/HX-Music"
  
  echo "=== 安装主程序 ==="
  cmake --install build --prefix "$pkgdir/usr"

  # 安装图标
  echo "=== 安装图标 ==="
  if [ -f "HX-Music-Client/resources/logo/appIcon.png" ]; then
    echo "找到图标在 HX-Music-Client/resources/logo/appIcon.png"
    mkdir -p "$pkgdir/usr/share/icons/hicolor/512x512/apps"
    cp -v HX-Music-Client/resources/logo/appIcon.png \
       "$pkgdir/usr/share/icons/hicolor/512x512/apps/$pkgname.png"
  else
    echo "警告: 未找到应用图标"
  fi

  # 创建桌面文件
  echo "=== 创建桌面文件 ==="
  mkdir -p "$pkgdir/usr/share/applications"
  cat > "$pkgdir/usr/share/applications/$pkgname.desktop" << EOF
[Desktop Entry]
Version=$pkgver
Type=Application
Name=HX-Music-Client
Comment=$pkgdesc
Exec=HX-Music-Client
Icon=$pkgname
Categories=AudioVideo
Terminal=false
StartupNotify=true
EOF

  echo "=== 打包完成 ==="
}